<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Review Comments (@fawda123) • dbhydroR</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script>
<script src="pkgdown.js"></script>



<meta property="og:title" content="Review Comments (@fawda123)" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">dbhydroR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/dbhydroR.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/dbhydroR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Review Comments (@fawda123)</h1>
    </div>


<div id="review-comments-fawda123" class="section level1">

<p>This package provides access to water quality and hydrological data from the dbhydro database provided by the South Florida Water Management District. Although the package has a regional focus, the database could be used to address more general ecological or environmental management questions. Having a package to more easily acquire the database will no doubt facilitate use and reach of the data.</p>
<p>The package is lightweight and is built around two main functions. The documentation and examples could be improved in some cases (see below), but overall I do not have any major concerns about package structure or functionality. However, access to metadata for the database is a serious limitation that needs to be addressed. Sure I could go online to find what I need but it seems like the package should facilitate that process in some way. The package does a good job retrieving data if the station id and test name are known but it would be much more helpful if there was some way to query the available information. Here are some options to consider:</p>
<ul>
<li>The vignette has an example of retrieving data using a wild card for the station id. Some more examples like this would be very helpful.</li>
</ul>
<p>** I believe that wild-cards only work with station-id(s). Are you thinking that test-names would also be exposed to wildcard selection?**</p>
<ul>
<li>Including more detailed metadata in the appendix of the vignette, e.g., stations, date ranges, etc.</li>
</ul>
<p><strong>I added a link to the available test-name listing in the <code>getwq</code> docs. I think there may be too many stations to include a managable listing in the vignette but see response to the next comment. </strong></p>
<ul>
<li>Including more functions to return and search metadata. My SWMPr package has similar functions (e.g., SWMPRr::site_codes or SWMPr::site_codes_ind) but I have the advantage of much fewer stations than those in dbhydro, so I’m not sure the best approach.</li>
</ul>
<p><strong>Thank you for the suggestion. I am working on wrapping the station-search utility at <a href="http://my.sfwmd.gov/dbhydroplsql/water_quality_data.show_group_station_characters" class="uri">http://my.sfwmd.gov/dbhydroplsql/water_quality_data.show_group_station_characters</a>. For now, I tried to make map-based selection via the ArcGIS online or Google Earth interface more prominent in the vignette and README. </strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/11c57f3a4f31b3804244ab269926798713f8aaa6" class="uri">https://github.com/SFWMD/dbhydroR/commit/11c57f3a4f31b3804244ab269926798713f8aaa6</a></p>
<div id="buildinstall" class="section level2">
<h2 class="hasAnchor">
<a href="#buildinstall" class="anchor"></a>Build/install</h2>
<ul>
<li>I was having problems building the vignette when running devtools::check(). The file dbhydroR.tex was not compiling and returning an error “support pakage l3kernel too old”. Updating the package in my LaTeX distribution fixed the issue. I’m guessing you didn’t have this issue since the package is already on CRAN but I wanted to mention it in case the problem occurs in the future. Otherwise, the devtools build on my Windows machine and the CRAN Windows builder (devtools::build_win()) passed with no notes, warnings, or errors.</li>
</ul>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<ul>
<li>The following error was returned running devtools::run_examples(pkg = ‘.’, run = FALSE)):</li>
</ul>
<blockquote>
<p>cleanhydro(gethydro(dbkey = “15081”, date_min = “2013-01-01”, date_max = “2013-02-02”))<br>
Error: is.response(x) is not TRUE</p>
</blockquote>
<p>I ran the check to include examples in \dontrun tags, as for the above. It makes sense to not run the example if it’s supposed to fail but there is no description exaplaining what the example shows. Either fix the example above or provide some explanation as to why it fails. All other examples ran without issues.</p>
<p><strong>The example has been fixed and now runs without error</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/ca676ef38c598ac6038dcd4217df15745ef67260" class="uri">https://github.com/SFWMD/dbhydroR/commit/ca676ef38c598ac6038dcd4217df15745ef67260</a> <a href="https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940" class="uri">https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940</a></p>
</div>
<div id="documentationvignette" class="section level2">
<h2 class="hasAnchor">
<a href="#documentationvignette" class="anchor"></a>Documentation/vignette</h2>
<ul>
<li>Maybe you should include some details (@details) for getwq and gethydro. The documentation for each is minimal, so perhaps add some of the text in the vignette to the help files for each function.</li>
</ul>
<p><strong>Great suggestion! More detail has been added to the docs for getwq and gethydro.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce" class="uri">https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce</a></p>
<ul>
<li>As noted above under documentation requirements, the README does not include a ‘statement of need clearly stating problems the software is designed to solve and its target audience’. The text from the onboarding issue above would be a good addition, i.e., ‘dbhydroR provides scripted access to the South Florida Water Management District’s DBHYDRO database which holds over 35 million water quality and hydrologic data records from the Florida Everglades and surrounding areas. The target audience is anyone interested in water quality and hydrologic data from the Florida Everglades - ecologists, engineers, meteorologists, hydrogeologists, hydrologists, etc.’</li>
</ul>
<p><strong>This has been added to the README and vignette.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/6a277de115df38dd4ff214f2f2b7e5a81ccfb272" class="uri">https://github.com/SFWMD/dbhydroR/commit/6a277de115df38dd4ff214f2f2b7e5a81ccfb272</a> <a href="https://github.com/SFWMD/dbhydroR/commit/7a7d4142192d62a55d6757dd5510889b21055f28" class="uri">https://github.com/SFWMD/dbhydroR/commit/7a7d4142192d62a55d6757dd5510889b21055f28</a></p>
<ul>
<li>For the vignette (or even on the README), I think it would be useful to provide a more user-friendly view of the available stations for getwq. The link in the vignette is to a KMZ file, which is not easily viewed. I tried installing the KML/KMZ Viewer for Chrome but it was blocked on my goverment computer, so I suspect others would have problems. Another option is to include an attachment to the vignette with a table or map showing the stations.</li>
</ul>
<p><strong>Links to the equivalent ArcGIS Online station map have been added to the vignette and README, and function docs. Hopefully this will make it more generally accessible.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/11c57f3a4f31b3804244ab269926798713f8aaa6" class="uri">https://github.com/SFWMD/dbhydroR/commit/11c57f3a4f31b3804244ab269926798713f8aaa6</a> <a href="https://github.com/SFWMD/dbhydroR/commit/3750b847e029373a2c8a2d8f5d9d3863e3a2bed0" class="uri">https://github.com/SFWMD/dbhydroR/commit/3750b847e029373a2c8a2d8f5d9d3863e3a2bed0</a> <a href="https://github.com/SFWMD/dbhydroR/commit/e66be8f4773e50f7f29505895e785fa80c42de54" class="uri">https://github.com/SFWMD/dbhydroR/commit/e66be8f4773e50f7f29505895e785fa80c42de54</a></p>
</div>
<div id="functions" class="section level2">
<h2 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h2>
<ul>
<li>I’m wondering if cleanhydro and cleanwq should be exported since they are only used within getwq and gethydro. I say this because the documentation is sparse (no details, no returned value description, minimal examples). Maybe it’s better not to export. Would a user ever have a separate need for these functions?</li>
</ul>
<p><strong>I think it is best to have these functions exported. I envision a use-case where dplyr/SQL-like data would be preferable to the default format. Exposing these functions would allow for the ability to switch to non-dplyr/SQL-like data without re-pulling the data. Also, I added more detail to the clean* docs and refactored <code>cleanhydro</code> to be more consistent with <code>cleanwq</code></strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940" class="uri">https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940</a></p>
<ul>
<li>For cleanwq, the vignette says that rows with missing data are removed. What happens with these rows if multiple stations or ‘test_names’ are queried? Is the entire row removed even if data are available for the other columns? I think some clarification is needed.</li>
</ul>
<p><strong>Hmm, possibly you are referring to the “QA blanks” discussion? This refers not to missing data but to analytical samples run to check for equipment/process contamination. I have added text to the vignette to this effect.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/5d4fe25aec7b4c0b5aaf4ecffc0832196d57ca9a" class="uri">https://github.com/SFWMD/dbhydroR/commit/5d4fe25aec7b4c0b5aaf4ecffc0832196d57ca9a</a></p>
</div>
<div id="contributing" class="section level2">
<h2 class="hasAnchor">
<a href="#contributing" class="anchor"></a>Contributing</h2>
<ul>
<li>Might be worth including a contributing.md file on the repo, or something more minimal in the README. Maybe modify this for your needs?</li>
</ul>
</div>
<div id="compliance-with-ropensci-packaging-guide" class="section level2">
<h2 class="hasAnchor">
<a href="#compliance-with-ropensci-packaging-guide" class="anchor"></a>Compliance with rOpenSci Packaging Guide</h2>
<p>My comments above address most of the compliance concerns for rOpenSci. Below are some minor, additional points.</p>
<div id="function-variable-naming" class="section level3">
<h3 class="hasAnchor">
<a href="#function-variable-naming" class="anchor"></a>Function variable naming</h3>
<p>I guess the CRAN gatekeepers don’t care about this but I was having a mental block with getwq given it’s similarity to getwd. You might consider changing the function name to make it more distinct.</p>
</div>
<div id="readme" class="section level3">
<h3 class="hasAnchor">
<a href="#readme" class="anchor"></a>README</h3>
<p>The ropensci footer will have to be added eventually: <a href="http://ropensci.org"><img src="http://ropensci.org/public_images/github_footer.png" alt="ropensci_footer"></a></p>
</div>
<div id="code-of-conduct" class="section level3">
<h3 class="hasAnchor">
<a href="#code-of-conduct" class="anchor"></a>Code of conduct</h3>
<p>Also consider adding the code of conduct badge with devtools::use_code_of_conduct.</p>
<p><strong>A COC has been added.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/0758c0cc3763f22cfcec2090ca3ed784699e870c" class="uri">https://github.com/SFWMD/dbhydroR/commit/0758c0cc3763f22cfcec2090ca3ed784699e870c</a></p>
<p>Hopefully these comments are helpful. Let me know if you have any questions.</p>
</div>
</div>
</div>
<div id="review-comments-aappling-usgs" class="section level1">
<h1 class="hasAnchor">
<a href="#review-comments-aappling-usgs" class="anchor"></a>Review Comments (@aappling-usgs)</h1>
<p>This package provides scriptable access to an extensive Florida water quality/quantity database, DBHYDRO. It’s also noticeably faster than the browser-based interface. dbhydroR will enhance the usability of the database and the reproducibility of analyses of DBHYDRO data.</p>
<p>I agree with @fawda123 that the largest room for improvement is in the documentation. I have also made suggestions below for increasing the flexibility of the data-cleaning functions to serve several common use cases, and I’ve pointed out a few edge cases where the package’s functionality might surprise a user.</p>
<div id="documentation" class="section level2">
<h2 class="hasAnchor">
<a href="#documentation" class="anchor"></a>Documentation</h2>
<p>As @fawda123 noted, it can be hard to identify the station IDs and tests you want if you don’t know what the options are. There are a few ways you could helper users:</p>
<ul>
<li>You have several great links in the vignette that could be ported to the corresponding help files.</li>
</ul>
<p><strong>Great suggestion. I ported these links and added links to the ArcGIS Online Station Map.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce" class="uri">https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce</a></p>
<ul>
<li>The Google Earth kmz file is excellent for interactively identifying sites and timeseries. However, <a href="http://my.sfwmd.gov/KMLEXT/CUSTOMKMLS/DBHydro/DBHydroKML/DBHYDRO_KML.kmz" class="uri">http://my.sfwmd.gov/KMLEXT/CUSTOMKMLS/DBHydro/DBHydroKML/DBHYDRO_KML.kmz</a> doesn’t open a browser window as a user might expect - maybe include some suggestions for how to best open the file, like on p. 56 of the DBHYDRO manual.</li>
<li>If you’re feeling ambitious, functions that return lists of options (sites, tests) would enhance users’ ability to search sites programatically. I also see a simplicity/maintainability argument for avoiding this route.</li>
</ul>
<p><strong>I am working on wrapping the station-search utility at <a href="http://my.sfwmd.gov/dbhydroplsql/water_quality_data.show_group_station_characters" class="uri">http://my.sfwmd.gov/dbhydroplsql/water_quality_data.show_group_station_characters</a>. For now, I tried to make map-based selection via the ArcGIS online or Google Earth interface more prominent in the vignette and README.</strong></p>
<p>Questions that arose on my first encounter with the package/dataset:</p>
<ul>
<li>What does a dbkey represent? A site, a timeseries, …? <strong>A dbkey represents a unique site x variable time series. I added some more info about dbkeys to the <code>gethydro</code> docs.</strong>
</li>
</ul>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce" class="uri">https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce</a></p>
<ul>
<li>How should I cite DBHYDRO and/or the dbhydroR package?</li>
</ul>
<p><strong>A notice about <code>citation()</code> has been added to the README</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/bbf0246398ef1446feca5be4fde0e98126e39b7b" class="uri">https://github.com/SFWMD/dbhydroR/commit/bbf0246398ef1446feca5be4fde0e98126e39b7b</a></p>
<p>Other documentation thoughts</p>
<ul>
<li>The description of “cleaned output” in the vignette could also be copied right over to the help files for getwd and gethydro (and their internal cleaning functions if those continue to be exported).</li>
</ul>
<p><strong>I expanded the docs for the get* and clean* functions to describe what goes on in the respective functions. I also refactored <code>cleanhydro</code> to be more consistent with <code>cleanwq</code> (they both operate on <code>data.frame</code> objects now).</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce" class="uri">https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce</a> <a href="https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940" class="uri">https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940</a></p>
<ul>
<li>Contribution guidelines could be added to the README or a CONTRIBUTING file.</li>
</ul>
<p><strong>The contributing guidelines of the other rOpenSci repos appear to be fairly specific to rOpenSci. I wonder if I should hold off on this until we are closer to acceptance?</strong></p>
</div>
<div id="buildinstall-1" class="section level2">
<h2 class="hasAnchor">
<a href="#buildinstall-1" class="anchor"></a>Build/install</h2>
<ul>
<li>I had no trouble installing/building the package from CRAN, GitHub, or a local clone of the repository.</li>
<li>The GitHub repository name is dbhydro while the package name is dbhydroR. You might consider switching to the same name in both places to make it ever-so-slightly easier to find the package on GitHub. (E.g., my first try was devtools::install_github(‘SFWMD/dbhydroR’) because I knew the package name and only glanced at the URL.)</li>
</ul>
<p><strong>The repo name has been switched to match the package name.</strong></p>
</div>
<div id="examplestests" class="section level2">
<h2 class="hasAnchor">
<a href="#examplestests" class="anchor"></a>Examples/tests</h2>
<ul>
<li>I encountered the same error as @fawda123 on running the example for cleanhydro:</li>
</ul>
<blockquote>
<p>devtools::run_examples(run=FALSE)<br>
…<br>
cleanhydro(gethydro(dbkey = “15081”, date_min = “2013-01-01”, date_max = “2013-02-02”))<br>
Error: is.response(x) is not TRUE</p>
</blockquote>
<ul>
<li>devtools::check() runs cleanly with 0 errors, 0 warnings, and 0 notes.</li>
</ul>
<p><strong>The example has been fixed and now runs without error</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/ca676ef38c598ac6038dcd4217df15745ef67260" class="uri">https://github.com/SFWMD/dbhydroR/commit/ca676ef38c598ac6038dcd4217df15745ef67260</a> <a href="https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940" class="uri">https://github.com/SFWMD/dbhydroR/commit/86436e321bce70501a1aa04e5f5e0a3b890b3940</a></p>
</div>
<div id="possibly-unnecessary-files-code" class="section level2">
<h2 class="hasAnchor">
<a href="#possibly-unnecessary-files-code" class="anchor"></a>Possibly unnecessary files &amp; code</h2>
<ul>
<li>The NEWS file has output: pdf_document at the top. Are you using this feature?</li>
</ul>
<p><strong>These lines have been removed.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/4cc1b2d14357502d7f248a3e78558690e83cd357" class="uri">https://github.com/SFWMD/dbhydroR/commit/4cc1b2d14357502d7f248a3e78558690e83cd357</a></p>
<ul>
<li>Do you need all of the files in dbhydro/vignettes? DFlowInterpR.bib~, Thumbs.db, and Untitled Document~ (and maybe others) might not be getting used.</li>
</ul>
<p><strong>These files have been removed.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/088884276228f665e2b42d48a2ad318d71d8fea0" class="uri">https://github.com/SFWMD/dbhydroR/commit/088884276228f665e2b42d48a2ad318d71d8fea0</a> <a href="https://github.com/SFWMD/dbhydroR/commit/9186979e9ca2a5694d68bcdf863c326d98f304b6" class="uri">https://github.com/SFWMD/dbhydroR/commit/9186979e9ca2a5694d68bcdf863c326d98f304b6</a></p>
</div>
<div id="functions-1" class="section level2">
<h2 class="hasAnchor">
<a href="#functions-1" class="anchor"></a>Functions</h2>
<p><strong>getwq + gethydro</strong></p>
<p>These functions have a clean, intuitive interface. A few thoughts:</p>
<ul>
<li>It would be helpful to more thoroughly explain dbkey in the documentation for gethydro.</li>
</ul>
<p><strong>I included some additional information about <code>dbkey</code> in the <code>gethydro</code> docs.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce" class="uri">https://github.com/SFWMD/dbhydroR/commit/8b67b622a96df66f4bab968f0cf17787de7792ce</a></p>
<ul>
<li>Is it / could it be possible to pass dbkey into getwq, as it is for gethydro? One dbkey might be easier than site+test for some programming applications, and it looks like water quality data do have dbkeys, e.g.:</li>
</ul>
<blockquote>
<p>getdbkey(stationid = “C111%”, stat = ‘MEAN’, category = “WQ”)<br>
Search results for ‘C111% WQ’<br>
Dbkey Group Data Type Freq Recorder Start Date End Date<br>
1 38097 C111WETL H2OT DA ???? 04-OCT-2003 10-OCT-2011<br>
2 38104 C111WETL SALIN DA ???? 04-OCT-2003 10-OCT-2011<br>
3 38100 C111WETL SCOND DA ???? 04-OCT-2003 10-OCT-2011</p>
</blockquote>
<p><strong>I realize that this is a bit confusing. The <code>getwq</code> function pulls data from a seperate set of DBHYDRO tables than <code>gethydro</code>. Only the <code>gethydro</code> tables contain dbkeys. Then, confusingly, the <code>gethydro</code> tables have a category called <code>"WQ"</code>. The <code>getwq</code> tables do not support selection by dbkey. The <code>getwq</code> water quality data is generated from laboratory tests while the <code>gethydro</code> <code>"WQ"</code> data is generated from things like automated sondes.</strong></p>
<ul>
<li>Two things only occur in getwq if raw==FALSE which I expected to be conditional: (1) the message “No data found” doesn’t occur even if there are no data, and (2) MDL handling doesn’t occur even if I specify mdl_handling. My favorite solution would be to make these things happen regardless of the value of raw, but another option would be to document them prominently in the ?getwq help file.</li>
</ul>
<blockquote>
<p>getwq(“FLAB01”, “2014-09-14”, “2014-09-18”, “NITRATE+NITRITE-N”, raw = TRUE)$Value<br>
[1] -0.01<br>
getwq(“FLAB01”, “2014-09-14”, “2014-09-18”, “NITRATE+NITRITE-N”, raw = TRUE, mdl_handling=‘half’)$Value<br>
[1] -0.01</p>
</blockquote>
<p><strong>I refactored <code>getwq</code> and <code>cleanwq</code> so that MDL handling occurs regardless of how <code>raw</code> is set. Also, the “No data found” message should now appear regardless of how <code>raw</code> is set.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/8a629183c03003175918640937ed18666a56f5eb" class="uri">https://github.com/SFWMD/dbhydroR/commit/8a629183c03003175918640937ed18666a56f5eb</a></p>
<p><strong>getdbkey</strong></p>
<p>Though not advertised in the README, the getdbkey function looks like a useful way to identify datasets to download. With that in mind, I have a few suggestions that are mostly illustrated by this example:</p>
<blockquote>
<p>getdbkey(stationid = “C111%”, stat = ‘MEAN’, category = “WQ”, detail.level=“full”)<br>
Search results for ‘C111% WQ’<br>
Get Data Dbkey \nStation\n Group Data Type Freq Stat Recorder Agency<br>
1 38097 C111WETLND C111WETL H2OT DA MEAN ???? USGS<br>
2 38104 C111WETLND C111WETL SALIN DA MEAN ???? USGS<br>
3 38100 C111WETLND C111WETL SCOND DA MEAN ???? USGS<br>
Start Date End Date Strata County Op Num Latitude Longitude X Coord<br>
1 04-OCT-2003 10-OCT-2011 0 DAD Â 251740 803112 814755.394<br>
2 04-OCT-2003 10-OCT-2011 0 DAD Â 251740 803112 814755.394<br>
3 04-OCT-2003 10-OCT-2011 0 DAD Â 251740 803112 814755.394<br>
Y Coord Basin Struct Section Township Range<br>
1 349549.418 C111_CO Â 15 59 38<br>
2 349549.418 C111_CO Â 15 59 38<br>
3 349549.418 C111_CO Â 15 59 38</p>
</blockquote>
<p><strong>I added some advertisement for <code>getdbkey</code> to the README.</strong></p>
<ul>
<li>Calls with detail.level=‘full’ return a column named “\nStation\n”. I’d prefer “Station” if there’s no reason to stick with the extra newlines.</li>
<li>The values of Latitude and Longitude are unconventionally formatted. Would you consider converting them to decimal degrees?</li>
</ul>
<p><strong>I removed the extra newlines from “Station” and formatted Latitude and Longitude as decimal degrees.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/3df0ad17f4e1b4f78f765b5bd182b1b3d4d34446" class="uri">https://github.com/SFWMD/dbhydroR/commit/3df0ad17f4e1b4f78f765b5bd182b1b3d4d34446</a></p>
<ul>
<li>Are the values in the “Struct” column being parsed correctly? I don’t know what to make of Â. It seems to appear in other columns, too, in other queries.</li>
</ul>
<p><strong>I am not getting <code>Â</code> printed in any of the columns. Maybe I fixed it as a side-effect of another commit? The following line prints a reasonable (non-blank) value of <code>Struct</code> for me:</strong></p>
<blockquote>
<p>getdbkey(category = “SW”, stationid = “ALLIGAT”, param = “STG”, detail.level = “full”)</p>
</blockquote>
<ul>
<li>Does anything useful ever appear in the “Get Data” column?</li>
</ul>
<p><strong>Good catch. No it doesn’t. This is an artifact from the web interface. I removed this column.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/b68cc5ed0c3814455bd104c22ff828687031546a" class="uri">https://github.com/SFWMD/dbhydroR/commit/b68cc5ed0c3814455bd104c22ff828687031546a</a></p>
<ul>
<li>Consider using stringsAsFactors=FALSE so that Station, Dbkey, etc. come back as strings.</li>
</ul>
<p><strong>Good suggestion. I made this change.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/3df0ad17f4e1b4f78f765b5bd182b1b3d4d34446" class="uri">https://github.com/SFWMD/dbhydroR/commit/3df0ad17f4e1b4f78f765b5bd182b1b3d4d34446</a></p>
<ul>
<li>When I try to get a more complete list of sites/tests to choose from, it seems that I’m limited to 100 dbkeys. This limitation should probably be more clearly documented and/or circumvented. <a href="http://my.sfwmd.gov/dbhydroplsql/show_dbkey_info.show_station_info?v_station=I%25">http://my.sfwmd.gov/dbhydroplsql/show_dbkey_info.show_station_info?v_station=I%25</a>
</li>
</ul>
<blockquote>
<p># we’d expect &gt;100 dbkeys in this query<br>
nrow(getdbkey(category = “GW”, detail.level = “full”))<br>
Search results for ‘NA GW’<br>
[1] 100<br>
# because we easily get &gt;100 sites combined in these two queries:<br>
dba &lt;- getdbkey(stationid = ‘A%’, category = “GW”, detail.level = “full”)<br>
Search results for ‘A% GW’<br>
dbi &lt;- getdbkey(stationid = ‘I%’, category = “GW”, detail.level = “full”)<br>
Search results for ‘I% GW’<br>
nrow(dba) + nrow(dbi)<br>
[1] 134</p>
</blockquote>
<p><strong>I circumvented this limitation.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/b68cc5ed0c3814455bd104c22ff828687031546a" class="uri">https://github.com/SFWMD/dbhydroR/commit/b68cc5ed0c3814455bd104c22ff828687031546a</a></p>
<p><strong>cleanwq + cleanhydro</strong></p>
<ul>
<li>In cleanwq at <a href="https://github.com/SFWMD/dbhydro/blob/master/R/dbhydro_clean.R#L27" class="uri">https://github.com/SFWMD/dbhydro/blob/master/R/dbhydro_clean.R#L27</a> and in cleanhydro at <a href="https://github.com/SFWMD/dbhydro/blob/master/R/dbhydro_clean.R#L98" class="uri">https://github.com/SFWMD/dbhydro/blob/master/R/dbhydro_clean.R#L98</a>, it looks like the timezone a user gets back will depend on the timezone where he/she is located, though probably all the data are in Eastern time, right? This is especially problematic if the data are not stored with daylight savings time or with a different daylight savings time than that of the user’s locale. For example, running the following query in Arizona, I get:</li>
</ul>
<blockquote>
<p>h &lt;- gethydro(dbkey = “IY639”, date_min = “2009-01-30”, date_max = “2009-01-31”)<br>
Warning messages:<br>
1: In cleanhydro(res) : Column headings missing. Guessing…<br>
2: In cleanhydro(res) : Instantaneous data detected<br>
head(h$date)<br>
[1] “2009-01-30 00:40:00 MST” “2009-01-30 00:55:00 MST” “2009-01-30 01:10:00 MST”<br>
[4] “2009-01-30 01:25:00 MST” “2009-01-30 01:40:00 MST” “2009-01-30 01:55:00 MST”</p>
</blockquote>
<p><strong>I forced hydro and wq date/times to return in EST.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/4d1dd1552c08568bc429959dd6b52898438d25b5" class="uri">https://github.com/SFWMD/dbhydroR/commit/4d1dd1552c08568bc429959dd6b52898438d25b5</a> <a href="https://github.com/SFWMD/dbhydroR/commit/239c03857d721d363fc373396c0e3e442a920d59" class="uri">https://github.com/SFWMD/dbhydroR/commit/239c03857d721d363fc373396c0e3e442a920d59</a></p>
<ul>
<li>In cleanhydro, why is “Instantaneous data detected” a warning rather than a message? Is it possible for instantaneous data to make trouble?</li>
</ul>
<p><strong>This has been changed to a message rather tha a warning. The raw server response for instantaneous data returns no column headers. These are assumed, hence the warning/message. The column assignments seem pretty reliable. Maybe I can drop these messages.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/2d9902d75d2ed2ec5ef90d7a0bda18b8b778525d" class="uri">https://github.com/SFWMD/dbhydroR/commit/2d9902d75d2ed2ec5ef90d7a0bda18b8b778525d</a></p>
<ul>
<li>At first glance, I agreed with @fawda123 that it would make sense not to export the cleanwq and cleanhydro functions because they are wrapped by getwd and gethydro. After more thought, though, I decided that I might often want to retain the Station.ID column and the long format (e.g., for dplyr-style analyses of multiple sites or tests) but might also want to specify the mdl_handling and/or get back parsed timestamps. I see no one-line option for these use cases, and it makes me wonder if the cleaning functionality could be split into things you’d almost always want (parsed timestamps, connecting metadata to headers, maybe move the Value column closer to the left) and things you might want to specify in various ways (MDL handling, selecting specific columns, switching between wide and long, renaming the value column). The former functionality could be the default in getwd and gethydro while the latter could live in (a) exported functions that you’d call separately or (b) new arguments to getwd and gethydro.</li>
</ul>
<p><strong>Maybe I have captured the spirit of this comment by standardizing the behavior of the clean* functions, and forcing mdl_handling to occur regardless of the value of <code>raw</code>? Also, timestamps are parsed to the <code>date</code> column regardless of the value of <code>raw</code>.</strong></p>
<ul>
<li>If you decide that cleanwq and cleanhydro should continue to be exported functions, they should be used in examples in the README and vignette.</li>
</ul>
<p><strong>I aded examples to the README and vignette.</strong></p>
<p><a href="https://github.com/SFWMD/dbhydroR/commit/cf5ebd7d134a5eaf9107f190aa931d8af25f1226" class="uri">https://github.com/SFWMD/dbhydroR/commit/cf5ebd7d134a5eaf9107f190aa931d8af25f1226</a></p>
<p><strong>Signing off</strong></p>
<p>This package is already a nice contribution - thanks for developing it. Let me know if you’d like to clarify/discuss any of the above points. Best, Alison (@aappling-usgs)</p>
</div>
</div>


  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joseph Stachelek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

